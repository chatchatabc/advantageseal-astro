---
import { t, changeLanguage } from "i18next";
import { utilGetCurrentLanguage } from "@helpers/commonUtils";
//components
import Layout from "@layouts/Layout.astro";
import InnerSubNav from "@components/theme/InnerSubNav.astro";
import Banner from "@components/theme/Banner.astro";
import BreadCrumbs from "@components/theme/BreadCrumbs.astro";
import BackBtn from "@components/theme/BackBtn.astro";
import { Picture } from "astro-imagetools/components";
import productsJson from "@data/pages/products.json";
import productCategoriesJson from "@data/product-categories.json";
//data types
import type { PageMetaTag, OpenGraphMetaTag, TwitterMetaTag, } from "@customTypes/seo/types";

changeLanguage("cn");

export async function getStaticPaths() {
    return productCategoriesJson.contents.map((category) => {
        return {
            params: {
                category: category.slug,
            },
            props: {
                category: category.slug,
                products: productsJson.list.filter((product) => product.category === category.slug),
            },
        };
    });
}
type Props = {
    category: string;
    products: {
        slug: string;
        name: string;
        category: string;
        ogImage: string;
    }[];
};
const { category, products } = Astro.props as Props;
const page: PageMetaTag = {
    title: `${t(`links:${category}`)} | ${t("site-info:pageTitle")}`,
};
const openGraph: OpenGraphMetaTag = {
    title: `${t(`links:${category}`)} | ${t("site-info:pageTitle")}`,
    image: t("products:contents.type-16" + ".bannerImageSrc"),
};
const twitter: TwitterMetaTag = {
    title: `${t(`links:${category}`)} | ${t("site-info:pageTitle")}`,
    image: t("products:contents.type-16" + ".bannerImageSrc"),
};
const bannerImageSrc = t("products:contents.type-16" + ".bannerImageSrc");
const bannerHeight = "200px";
const trueImage = false;
const trueImageStyle = "";
let currNewsCategory: string = t(`links:${category}`); //current name of category
---

<Layout page={page} openGraph={openGraph} twitter={twitter}>
  <Banner
    bannerImageSrc={bannerImageSrc}
    bannerHeight={bannerHeight}
    trueImage={trueImage}
    trueImageStyle={trueImageStyle}
  />
  <div class="container mx-auto w-full md:w-11/12 lg:w-10/12">
    <InnerSubNav name="products" />
    <div class="mb-6">
      <BreadCrumbs label={currNewsCategory} />
    </div>
    <main class="">
      <div class="flex flex-row flex-wrap">
        {
          products.map((product) => {
            return (
              <a
                class="w-full md:w-6/12 scale-[0.95] border-[1px] border-solid border-[#eee] transition shadow-lg hover:scale-[1] lg:w-4/12 h-fit"
                href={`${utilGetCurrentLanguage(
                  Astro.url.toString()
                )}/products/${product.category}/${product.slug}/`}
              >
                <div class="block p-4">
                  <Picture
                    src={t(
                      `products:contents.${product.slug}.contents.section1.imageGallery.images.image1.src`
                    )}
                    alt={t(
                      `products:contents.${product.slug}.contents.section1.imageGallery.images.image1.alt`
                    )}
                  />
                </div>
                <div class="py-8">
                  <div class="text-[1.25rem] text-[#006699] py-1 px-4 font-semibold border-2 border-solid border-[#006699] rounded-[0.75rem] w-fit mx-auto">
                    {t(`products:contents.${product.slug}.name`)}
                  </div>
                </div>
              </a>
            );
          })
        }
      </div>
    </main>
    <div class="mb-16 flex justify-center">
      <BackBtn />
    </div>
  </div>
</Layout>
