---
import i18next, { t, changeLanguage } from "i18next";
import { utilGetCurrentLanguage } from "@helpers/commonUtils";
import Layout from "@layouts/Layout.astro";
import homeJson from "@data/pages/home.json";
import type { PageMetaTag, OpenGraphMetaTag, TwitterMetaTag, } from "@customTypes/seo/types";
//import defaultJson from "@data/site-info.json";
import Carousel from "@components/theme/Carousel.astro";
import { Img, BackgroundImage } from "astro-imagetools/components";
import Marquee from "@components/theme/Marquee.astro";
import type { MarqueeImage } from "@customTypes/marquee/types";
import AboutStub from "@components/landing-page/AboutStub.astro";
import NewsStub from "@components/landing-page/NewsStub.astro";

changeLanguage("cn");

var metaTagRef = "page-home:metaTag";
const { pathname } = Astro.url;
const currentLanguage = utilGetCurrentLanguage(pathname);
const pageMetaTag: PageMetaTag = {
    title: t(metaTagRef + ".pageTitle") ?? t("site-info.pageTitle"),
    description: t(metaTagRef + ".pageDescription") ?? t("site-info.pageTitle"),
    keywords: t(metaTagRef + ".pageKeywords") ?? t("site-info:pageKeywords"),
    author: t(metaTagRef + ".pageAuthor") ?? t("site-info:pageAuthor"),
}, opengraphMetaTag: OpenGraphMetaTag = {
    title: t(metaTagRef + ".ogTitle") ??
        t(metaTagRef + ".pageTitle") ??
        t(metaTagRef + ".twitterTitle") ??
        t("site-info:ogTitle"),
    type: t(metaTagRef + ".ogType") ?? t("site-info:ogType"),
    image: t(metaTagRef + ".ogImage") ??
        t(metaTagRef + ".twitterImage") ??
        t("site-info:ogImage"),
    description: t(metaTagRef + ".ogDescription") ??
        t(metaTagRef + ".twitterDescription") ??
        t(metaTagRef + ".pageDescription") ??
        t("site-info:ogDescription"),
}, twitterMetaTag: TwitterMetaTag = {
    cardType: t(metaTagRef + ".twitterCardType") ?? t("site-info:twitterCardType"),
    title: t(metaTagRef + ".twitterTitle") ??
        t(metaTagRef + ".ogTitle") ??
        t("site-info:twitterTitle"),
    description: t(metaTagRef + ".description") ??
        t(metaTagRef + ".ogDescription") ??
        t("site-info:pageDescription"),
    image: t(metaTagRef + ".twitterImage") ??
        t(metaTagRef + ".ogImage") ??
        t("site-info:twitterImage"),
};
let marqueeImages: MarqueeImage[] = [];
let marqueeImagePrefix: string = t("page-home:marquee.prefix");
//get images from respective languages
Array.from({ length: parseInt(t("page-home:marquee.count")) }, (_, i) => i + 1).map((index: number) => {
    var tempMarqueeImage: MarqueeImage = {
        src: t("page-home:marquee." + marqueeImagePrefix + ".image" + index + ".src"),
        alt: t("page-home:marquee." + marqueeImagePrefix + ".image" + index + ".title"),
        label: t("page-home:marquee." + marqueeImagePrefix + ".image" + index + ".label"),
        href: t("page-home:marquee." + marqueeImagePrefix + ".image" + index + ".href"),
    };
    marqueeImages.push(tempMarqueeImage);
});
---

<Layout
  page={pageMetaTag}
  openGraph={opengraphMetaTag}
  twitter={twitterMetaTag}
>
  <main class="flex-grow relative">
    <section>
      <Carousel>
        <div class="relative h-0 pb-[26.07%]">
          {
            Array.from(
              { length: parseInt(t("page-home:carousel.count")) },
              (_, i) => i + 1
            ).map((index) => {
              return (
                <div class="image-element absolute top-0 opacity-0 transition-all duration-300 w-full flex justify-center">
                  <Img
                    src={t(
                      "page-home:carousel." +
                        i18next.language +
                        ".image" +
                        index
                    )}
                    alt={"image" + index}
                    layout="fullWidth"
                  />
                </div>
              );
            })
          }
        </div>
      </Carousel>
    </section>
    <!--Popular Products Section -->
    <section
      class="container p-4 w-full mx-auto space-y-4 mt-8 md:w-11/12 lg:w-10/12"
    >
      <div class="header flex flex-row items-end">
        <h3 class="text-[1.5rem] leading-8">
          {t("page-home:popularProducts.title")}
          <small class="text-xs text-[#777777]">
            {t("page-home:popularProducts.subText")}
          </small>
        </h3>
      </div>
      <blockquote
        class="flex flex-row p-2 border-l-4 border-solid border-l-[#cc0000] bg-[#fbfbfb] flex-wrap whitespace-nowrap"
      >
        {
          homeJson.popularProducts.collection.map(
            (product: { name: string; href: string }, index: number) => {
              return (
                <a
                  class={`text-[13px] text-[#009ce0] px-2 font-semibold hover:text-[#cc0000] ${
                    homeJson.popularProducts.collection.length - 1 !== index &&
                    "border-solid border-r border-r-[#ccc]"
                  }`}
                  href={currentLanguage + product.href}
                  title={t(
                    "page-home:popularProducts.collection." +
                      product.name +
                      ".title"
                  )}
                >
                  {t(
                    "page-home:popularProducts.collection." +
                      product.name +
                      ".label"
                  )}
                </a>
              );
            }
          )
        }
      </blockquote>
      <Marquee images={marqueeImages} />
    </section>
    <!--Customer Center -->
    <section
      class="customer-center bg-[url('/images/landing-page/customer-center/g2.webp')] bg-repeat bg-[#0b4a75]"
      style=""
    >
      <div
        class="w-full block flex-row lg:flex lg:container lg:mx-auto lg:w-10/12"
      >
        <div class="w-full relative mx-auto lg:w-4/12">
          <div
            class="text-white text-center py-[50px] bg-cover"
            style={`background-image:url(${t(
              "page-home:customerCenter.image.src"
            )})`}
          >
            {t("page-home:customerCenter.label")}
          </div>
        </div>
        <div class="w-full flex flex-row mx-auto flex-wrap">
          <a
            href={utilGetCurrentLanguage(pathname) +
              t("page-home:customerCenter.children.child1.link")}
            class="flex flex-col w-6/12 hover:bg-[#005c85] sm:w-6/12 md:w-4/12 lg:2/12"
          >
            <div class="grow flex justify-center items-center py-8 lg:py-0">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="54"
                height="54"
                viewBox="0 0 20 20"
                ><path
                  fill="#ffffff"
                  d="M17 9V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h11a2 2 0 0 0 2-2v-2l5 4V5l-5 4z"
                ></path></svg
              >
            </div>

            <h3 class="text-white text-center pb-8">
              {t("page-home:customerCenter.children.child1.text")}
            </h3>
          </a>
          <a
            href={utilGetCurrentLanguage(pathname) +
              t("page-home:customerCenter.children.child1.link")}
            class="flex flex-col w-6/12 hover:bg-[#005c85] sm:w-6/12 md:w-4/12 lg:2/12"
          >
            <div class="grow flex justify-center items-center py-8 lg:py-0">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="54"
                height="54"
                viewBox="0 0 576 512"
                ><path
                  fill="white"
                  d="m290.8 48.6l78.4 29.7l-81.2 31.2l-81.2-31.2l78.4-29.7c1.8-.7 3.8-.7 5.7 0zM136 92.5v112.2c-1.3.4-2.6.8-3.9 1.3l-96 36.4C14.4 250.6 0 271.5 0 294.7v119.2c0 22.2 13.1 42.3 33.5 51.3l96 42.2c14.4 6.3 30.7 6.3 45.1 0L288 457.5l113.5 49.9c14.4 6.3 30.7 6.3 45.1 0l96-42.2c20.3-8.9 33.5-29.1 33.5-51.3V294.7c0-23.3-14.4-44.1-36.1-52.4l-96-36.4c-1.3-.5-2.6-.9-3.9-1.3V92.5c0-23.3-14.4-44.1-36.1-52.4L308 3.7c-12.8-4.8-26.9-4.8-39.7 0l-96 36.4C150.4 48.4 136 69.3 136 92.5zm256 118.1l-82.4 31.2v-89.2L392 121v89.6zm-237.2 40.3l78.4 29.7l-81.2 31.1l-81.2-31.1l78.4-29.7c1.8-.7 3.8-.7 5.7 0zm18.8 204.4V354.8l82.4-31.6v95.9l-82.4 36.2zm247.6-204.4c1.8-.7 3.8-.7 5.7 0l78.4 29.7l-81.3 31.1l-81.2-31.1l78.4-29.7zm102 170.3l-77.6 34.1V354.8l82.4-31.6v90.7c0 3.2-1.9 6-4.8 7.3z"
                ></path></svg
              >
            </div>

            <h3 class="text-white pb-8 text-center">
              {t("page-home:customerCenter.children.child2.text")}
            </h3>
          </a>
          <a
            href={utilGetCurrentLanguage(pathname) +
              t("page-home:customerCenter.children.child1.link")}
            class="flex flex-col w-6/12 hover:bg-[#005c85] sm:w-6/12 md:w-4/12 lg:2/12"
          >
            <div class="grow flex justify-center items-center py-8 lg:py-0">
              <svg
                class=""
                xmlns="http://www.w3.org/2000/svg"
                width="54"
                height="54"
                viewBox="0 0 20 20"
                ><path fill="white" d="M3 3H1v16h18v-2H3z"></path><path
                  fill="white"
                  d="M11 11L8 9l-4 4v3h14V5z"></path></svg
              >
            </div>
            <h3 class="text-white pb-8 grow-0 text-center">
              {t("page-home:customerCenter.children.child3.text")}
            </h3>
          </a>
        </div>
      </div>
    </section>
    <!--Product Application -->

    <section
      class="product-application container p-4 w-full mx-auto space-y-2 mt-8 md:w-11/12 lg:w-10/12"
    >
      <h2 class="text-[1.5rem] block">
        {t("page-home:productApplication.header")}
      </h2>
      <div class="w-full">
        <ul
          class="flex flex-row flex-wrap space-x-0 lg:space-x-8 lg:flex-nowrap"
        >
          {
            homeJson.productApplication.images.map((image, _) => {
              return (
                <li class="p-4 w-6/12 md:w-4/12 lg:w-2/12 lg:p-0">
                  <Img src={image.src} alt={image.alt} />
                </li>
              );
            })
          }
        </ul>
      </div>
    </section>
    <!--Stubs Section -->
    <section
      class="stubs-section container p-4 w-full mx-auto space-y-2 mt-8 md:w-11/12 lg:w-10/12 lg:flex lg:flex-row lg:space-y-0 lg:space-x-2"
    >
      <!--News Stub -->
      <div class="w-full lg:w-6/12">
        <NewsStub lang={i18next.language} />
      </div>
      <div class="w-full lg:w-6/12">
        <AboutStub tabs={homeJson.stubs.about.tabs} lang={i18next.language} />
      </div>
    </section>
  </main>
</Layout>
