---
import { Picture } from "astro-imagetools/components";
import i18next, { t } from "i18next";
import navBarJson from "@data/navbar.json";
import SubMenu from "@components/theme/navbar/SubMenu.svelte";
type Link = { name: string; link: string; children: Sublink[] };
type Sublink = { name: string; link: string };
const { links }: any = navBarJson;
//process the entire thing includidng the translation
var processedLinks: Link[] = [];
links.map((link: any) => {
  var processedLink: Link = { name: "", link: "", children: [] };
  processedLink.name = t("navigation:navbar." + link.name + ".name");
  processedLink.link = t("navigation:navbar." + link.name + ".link");

  link.children.map((navbarJsonSublink: { name: string }) => {
    var processedSublink: Sublink = { name: "", link: "" };
    processedSublink.name = t(
      "navigation:navbar." +
        link.name +
        ".sublinks." +
        navbarJsonSublink.name +
        ".name"
    );
    processedSublink.link = t(
      "navigation:navbar." +
        link.name +
        ".sublinks." +
        navbarJsonSublink.name +
        ".link"
    );
    processedLink.children.push(processedSublink);
  });
  processedLinks.push(processedLink);
});
//error in code does not properly filterout children when other navs in the future will have children
---

<header class="">
  <!--logo section -->
  <section class="w-full bg-white py-[1.25rem]">
    <div class="w-9/12 px-4 flex justify-between mx-auto container">
      <div class="company-logo">
        <a href="/">
          <Picture
            src="/images/company-logo.png"
            alt="AdvantageSeal logo"
            h={60}
          />
        </a>
      </div>
      <div class="flex flex-row">
        <!--hotline -->
        <div class="flex flex-1 items-center pr-[2rem]">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 448 512"
            class="h-[36px]"
            fill="#3ebe2b"
            ><path
              d="M64 32C28.7 32 0 60.7 0 96V416c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64H64zm90.7 96.7c9.7-2.6 19.9 2.3 23.7 11.6l20 48c3.4 8.2 1 17.6-5.8 23.2L168 231.7c16.6 35.2 45.1 63.7 80.3 80.3l20.2-24.7c5.6-6.8 15-9.2 23.2-5.8l48 20c9.3 3.9 14.2 14 11.6 23.7l-12 44C336.9 378 329 384 320 384C196.3 384 96 283.7 96 160c0-9 6-16.9 14.7-19.3l44-12z"
            ></path></svg
          >
          <div class="flex flex-col px-2">
            <span class="text-xs font-bold" style=""
              >{t("navigation:hotline")}</span
            >
            <span class="text-[16px] font-bold leading-[1rem]"
              >+86 (574)87500883</span
            >
          </div>
        </div>
        <!--language switch -->
        <div class="flex items-center">
          <div
            class="flex flex-row items-center overflow-hidden border border-[#009ce0] rounded-md w-[120px] h-[30px]"
          >
            <div
              class="text-center text-xs w-[60px] h-[30px] text-white bg-[#009ce0] flex items-center justify-center"
            >
              <a href="/" class="">中文</a>
            </div>
            <div
              class="text-center text-xs w-[60px] h-[30px] text-[#009ce0] bg-white flex items-center justify-center"
            >
              <a href="/en" class="">EN</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <!-- nav menu section -->
  <section class="bg-[#f1f1f1] w-full">
    <div class="w-9/12 mx-auto container">
      <ul class="flex flex-row">
        {
          processedLinks.map((processedLink: Link) => {
            return (
              <>
                <li class="group border-t-[3px] border-t-[#019cdf00]  text-[14px] hover:border-t-[#019cdf]">
                  <a
                    class="block px-[42px] py-[18px] pb-[21px] group-hover:bg-white"
                    href={processedLink.link}
                  >
                    {processedLink.name}
                  </a>
                  {processedLink.children.length > 0 && (
                    <SubMenu client:load links={processedLink.children!} />
                  )}
                </li>
              </>
            );
          })
        }
      </ul>
    </div>
  </section>
</header>
